<%- layout('boilerplate.ejs')%>
<link rel="stylesheet" href="stylesheets/profilePage.css">
<link rel="stylesheet" href="/stylesheets/home.css">
<!-- <link rel="stylesheet" href="/stylesheets/home.css"> -->

<div class="likedByList followersList d-none"  username="<%=user.username%>">
    <div class="header border-bottom text-center">Followers</div>
    <div class="likesList followerList"  username="<%=user.username%>">
        <div class="followedByUser clientFollow mx-auto my-3 d-none" username="<%=user.username%>" >
            <div class="row d-flex">
                <div
                    class="col-2 text-center  d-flex justify-content-center align-items-center p-0">
                    <img width="36px" height="36px" class="rounded-5"
                        src="https://images.unsplash.com/photo-1504208434309-cb69f4fe52b0?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80"
                        alt="">
                </div>
                <div class="col m-0 p-0 d-flex flex-column">
                    <div><b class="likedUserUsername"  username="<%=user.username%>"
                        ><%=currentUser.username%></b></div>
                    <div class="likedUserName"  username="<%=user.username%>" height="fit-content"
                        class="text-muted"
                        style="line-height: 50%; color: rgba(0,0,0,0,1)"></div>

                </div>
                <div class="col-3 justify-content-center align-items-center text-center ">
                    
                    <button class="btn ms-auto followBtn btn-primary my-auto text-center align-self-end  py-0" 
                    followingState="false" 
                    username="<%=user.username%>">
                    Follow
                </button> 
                
                </div>
            </div>
        </div>
        <% for(let follower of user.followedBy) {%>  
        <div class="followedByUser mx-auto my-3" username="<%=follower.username%>" serverside="true">
            <div class="row d-flex">
                <div
                    class="col-2 text-center p-0 d-flex justify-content-center align-items-center">
                    <img width="36px" height="36px" class="rounded-5"
                        src="https://images.unsplash.com/photo-1504208434309-cb69f4fe52b0?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80"
                        alt="">
                </div>
                <div class="col m-0 p-0 d-flex flex-column">
                    <div><b class="followerUsername"
                            username="<%=follower.username %>"> <%=follower.username%> </b></div>
                    <div class="followerName" username="<%=follower.username%>"
                        height="fit-content" class="text-muted"
                        style="line-height: 50%; color: rgba(0,0,0,0,1)"></div>
                </div>
                <div class="col-3 justify-content-center align-items-center text-center ">
                        <% if(currentUser.username===user.username){ %>
                            <button class="btn ms-auto followBtn btn-secondary my-auto text-center align-self-end  py-0" 
                                followingState="true" 
                                username="<%=follower.username%>" removeFollower="true">
                                Remove
                                </button> 
                        <% }else{ %>
                        <button  class="btn ms-auto followBtn <%=currentUser.following.includes(follower._id)?'btn-secondary':'btn-primary'%> my-auto text-center align-self-end  py-0" 
                        followingState="<%= currentUser.following.includes(follower._id)?'true':'false'%>" 
                        username="<%=follower.username%>" owner="<%=user.username%>" followFromFollowedByList="true">
                        
                        <%= currentUser.following.includes(follower._id)?'Unfollow':'Follow'%> 
                        </button> 
                        <% } %>
                    </div>
            </div>
        </div>
        <% } %>
    </div>
</div>
<div class="likedByList followingList d-none"  username="<%=user.username%>">
    <div class="header border-bottom text-center">Following</div>
    <div class="likesList followingt"  username="<%=user.username%>">
        <div class="following mx-auto my-3 d-none" username="<%=user.username%>" >
            <div class="row d-flex">
                <div
                    class="col-2 text-center  d-flex justify-content-center align-items-center p-0">
                    <img width="36px" height="36px" class="rounded-5"
                        src="https://images.unsplash.com/photo-1504208434309-cb69f4fe52b0?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80"
                        alt="">
                </div>
                <div class="col m-0 p-0 d-flex flex-column">
                    <div><b class="likedUserUsername"  username="<%=user.username%>"
                        ><%=currentUser.username%></b></div>
                    <div class="likedUserName"  username="<%=user.username%>" height="fit-content"
                        class="text-muted"
                        style="line-height: 50%; color: rgba(0,0,0,0,1)"></div>

                </div>
                <div class="col-3 px-3 text-center ">
                    <button width="100%" ;
                        class="followBtn my-auto text-center align-self-end  py-0 mt-2"
                        style="color:white;background-color: rgb(49, 114, 255);line-height: 50%;"
                        height="10px!important">Follow</button>
                </div>
            </div>
        </div>
        <% for(let follower of user.following) {%>  
        <div class="followingUser mx-auto my-3" username="<%=follower.username%>" serverside="true">
            <div class="row d-flex">
                <div
                    class="col-2 text-center p-0 d-flex justify-content-center align-items-center">
                    <img width="36px" height="36px" class="rounded-5"
                        src="https://images.unsplash.com/photo-1504208434309-cb69f4fe52b0?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80"
                        alt="">
                </div>
                <div class="col m-0 p-0 d-flex flex-column">
                    <div><b class="followingUsername"
                            username="<%=follower.username %>"> <%=follower.username%> </b></div>
                    <div class="followerName" username="<%=follower.username%>"
                        height="fit-content" class="text-muted"
                        style="line-height: 50%; color: rgba(0,0,0,0,1)"></div>
                </div>
                <div class="col-3 px-3 text-center ">
                    <button  class="btn ms-auto followBtn <%=currentUser.following.includes(follower._id)?'btn-secondary':'btn-primary'%> my-auto text-center align-self-end  py-0" 
                        followingState="<%= currentUser.following.includes(follower._id)?'true':'false'%>" 
                        username="<%=follower.username%>" owner="<%=user.username%>" followFromFollowingList="true">
                        
                        <%= currentUser.following.includes(follower._id)?'Unfollow':'Follow'%> 
                        </button> 
                </div>
            </div>
        </div>
        <% } %>
    </div>
</div>
<main class="profileMain ">
    
    <div class="pageHeader px-2 p-md-0">
        <div class="row d-flex profileHeader">
            <div class="col-4 p-0 d-flex userImage justify-content-center">
                <img width="150px" height="150px" class="userPhoto"
                    src="https://images.unsplash.com/photo-1504208434309-cb69f4fe52b0?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80"
                    alt="profile image">
            </div>
            
            <div class="col-lg-5 col-md-6 col-8 p-0 d-flex userDetails flex-column">
                <div class="mainDetails ps-2 ps-sm-0 p-md-none p-md-0">
                <div class="row firstDetails d-flex  pt-0 pt-md-2 mb-1">
                    <div class="col-2 p-0 d-flex" style="width: fit-content;font-size: 20px;"><b class=""><%=user.username%></b>
                        <svg aria-label="Options" class="ms-2 d-inline d-md-none x1lliihq x1n2onr6" color="rgb(0,0,0)" fill="rgb(0,0,0)" height="32" role="img" viewBox="0 0 24 24" width="32"><title>Options</title><circle cx="12" cy="12" r="1.5"></circle><circle cx="6" cy="12" r="1.5"></circle><circle cx="18" cy="12" r="1.5"></circle></svg>

                    </div>
                    <% if(currentUser.username === user.username){ %>
                    <div class="col-md p-0 d-flex pe-md-2 justify-content-md-end ">
                        <div class="my-md-none my-auto mt-md-none align-items-center">        
                        <button class="btn ms-auto btn-secondary p-0 px-2 me-1 me-md-2">Edit Profile</button><button class="btn btn-secondary p-0 px-2">View Archive</button>
                    </div>
                    <% }else{ %>
                    <div class="col-md p-0 d-flex pe-md-2 justify-content-md-center ">
                        <div class="my-md-none my-auto mt-md-none align-items-center">        
                           
                                <button  class="btn ms-auto followBtn <% let ok='false';user.followedBy.forEach(element => {if(element.equals(currentUser))ok='true';})%><%= ok==='true'?'btn-secondary':'btn-primary'%> p-0 px-2 me-2 me-md-1" 
                                followingState="<% let ok1='false'; user.followedBy.forEach(element => {if(element.equals(currentUser)) ok1='true';})%><%= ok1==='true'?'true':'false'%>" 
                                username="<%=user.username%>" followFromMainButton="true">
                                <% var ok2='false';
                                user.followedBy.forEach(element => {
                                    if(element.equals(currentUser)) ok2='true';
                                }) %>
                                <%= ok2==='true'?'Following':'Follow'%> 
                                </button> 
                                 
                                <button class="btn btn-secondary p-0 px-2"><svg aria-label="Similar accounts" class="x1lliihq x1n2onr6" color="rgb(245, 245, 245)" fill="rgb(245, 245, 245)" height="16" role="img" viewBox="0 0 24 24" width="16"><title>Similar accounts</title><path d="M19.006 8.252a3.5 3.5 0 1 1-3.499-3.5 3.5 3.5 0 0 1 3.5 3.5Z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="2"></path><path d="M22 19.5v-.447a4.05 4.05 0 0 0-4.05-4.049h-4.906a4.05 4.05 0 0 0-4.049 4.049v.447" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><line fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" x1="5.001" x2="5.001" y1="7.998" y2="14.003"></line><line fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" x1="8.004" x2="2.003" y1="11" y2="11"></line></svg></button>
                                <svg aria-label="Options" class="ms-2 d-inline d-md-inline d-none x1lliihq x1n2onr6" color="rgb(0,0,0)" fill="rgb(0,0,0)" height="32" role="img" viewBox="0 0 24 24" width="32"><title>Options</title><circle cx="12" cy="12" r="1.5"></circle><circle cx="6" cy="12" r="1.5"></circle><circle cx="18" cy="12" r="1.5"></circle></svg>                 
                            </div>
                    
                    </div>
                       <% } %>  
                </div>
                <div class="row secondDetails d-md-flex mt-3 d-none">
                    <div class="col-3 p-0 "><span class=""><b><%=posts.length%>&nbsp;</b> posts</span></div>
                    <div class="col p-0 "><span class="triggerFollowersList"><b class="numOfFollowers" username="<%=user.username%>"><%=user.followedBy.length%></b> followers</span></div>
                    <div class="col p-0"><span class="ms-auto triggerFollowingList" ><b class="numOfFollowing" username="<%=user.username%>"><%=user.following.length%></b> following</span></div>
                </div>
                <div class="bio d-none d-md-block d-none">bio</div>
            </div>
            
            </div>
        </div>
            <div class="col-4 p-0"></div>
           
        </div>
        <div class="bioMd d-block d-md-none">bio</div>
    </div>
    
    <div class="secondDetails768 border-top d-flex d-md-none d-block width-100 justify-content-around  align-items-center" >
        <div class="postsNum"><span class=""><b><%=posts.length%>&nbsp;</b> posts</span></div>
        <div class="followersNum"><span class=""><b>200 </b> followers</span></div>
        <div class="followingNum"><span class=""><b>200 </b> following</span></div>
    </div>  
    <div class="row d-flex p-0 profileLinksContainer border-top">
        <div class="col-md-4 col-3 p-0"></div>
        <div class="col-md-4 col-6 p-0 d-flex flex-row justify-content-between ">
            <div class="ProfileLinks currentPageProfileLink align-items-center d-flex pb-1">
                <span><svg aria-label="" class="x1lliihq x1n2onr6" color="rgb(0,0,0)" fill="rgb(245, 245, 245)" height="12" role="img" viewBox="0 0 24 24" width="12"><title></title><rect fill="none" height="18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="18" x="3" y="3"></rect><line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="9.015" x2="9.015" y1="3" y2="21"></line><line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="14.985" x2="14.985" y1="3" y2="21"></line><line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="21" x2="3" y1="9.015" y2="9.015"></line><line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="21" x2="3" y1="14.985" y2="14.985"></line></svg>
                    POSTS</span></div> 
            <div class="ProfileLinks align-items-center d-flex pb-1"><span>REELS</span></div> 
                <!-- <div>SAved</div> for current user-->
            <div class="ProfileLinks align-items-center d-flex pb-1"><span>TAGGED</span></div>
        </div>
        <div class="col-md-4 col-3 p-0"></div>
    </div>
    
    <div class="userPosts d-flex flex-wrap gap-1">
        
            
        
        <% for(let post of posts){ %>
            
            <div class="post p-0 comment-button" data_post_id="<%=post._id%>">
                <div class="heartIcon">
                        <svg aria-label="Like" color="rgb(255,255,255)" fill="rgb(255,255,255)" height="24" role="img" viewBox="0 0 24 24" width="24"><title>Like</title><path d="M16.792 3.904A4.989 4.989 0 0 1 21.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 0 1 4.708-5.218 4.21 4.21 0 0 1 3.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 0 1 3.679-1.938m0-2a6.04 6.04 0 0 0-4.797 2.127 6.052 6.052 0 0 0-4.787-2.127A6.985 6.985 0 0 0 .5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 0 0 3.518 3.018 2 2 0 0 0 2.174 0 45.263 45.263 0 0 0 3.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 0 0-6.708-7.218Z"></path></svg>                           
                        <span data_post_id="<%=post._id%>" class="numOfLikesProfilePost"><%=post.likedBy.length%></span>

                    </div>
                <div class="commentIcon">
                    
                    <svg aria-label="Comment" class="x1lliihq x1n2onr6" color="rgb(245, 245, 245)" fill="rgb(245, 245, 245)" height="24" role="img" viewBox="0 0 24 24" width="24"><title>Comment</title><path d="M20.656 17.008a9.993 9.993 0 1 0-3.59 3.615L22 22Z" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="2"></path></svg>                </span> 
                    <span data_post_id="<%=post._id%>" class="numOfCommentsProfilePost"><%=post.comments.length%></span>
                </div> 
                    
                    <img src="<%=post.images.postImage11%>" alt="" class="postImage">
                    
            </div> 
            
        <% } %>
        <div class="div modalPostHidden">
            <%-include('./article.ejs')%></div>
            
        </div>
        <div class="div modalPostHidden">
            <%-include('./modal-post.ejs')%></div>
            
        </div> 
</main>
<div class="overlay"><button class="closeBtn">&times;</button></div>
<script src="/js/likeLogic.js"></script>
<script src="/js/postOptions.js"></script>
<script src="/js/postModal.js"></script>
<script src="/js/reply.js"></script>
<script src="/js/follow.js"></script>